---
import Layout from "../layouts/Layout.astro";
import ChannelProjet from "../components/ui/ChannelProjet.astro";
import Fleche from "../components/ui/Fleche.astro";
import FooterAccueil from "../components/layout/FooterAccueil.astro";
import FooterAccueilMobile from "../components/layout/FooterAccueilMobile.astro";
import CvOverlay from "../components/layout/CvOverlay.astro";
import ContactOverlay from "../components/layout/ContactOverlay.astro";
import ParametresOverlay from "../components/layout/ParametresOverlay.astro";
import PresentationOverlay from "../components/layout/PresentationOverlay.astro";
---

<Layout
  title="Nicolas THAI - Portfolio Développeur Web"
  description="Accueil du portfolio de Nicolas THAI"
>
  <!-- Version Desktop -->
  <div class="hidden md:block">
    <!-- Zone principale avec grille de channels -->
    <main class="relative h-screen bg-background overflow-hidden">
      <!-- Container pour le carrousel -->
      <div class="relative w-full h-full overflow-hidden">
        <!-- Grille unique avec tous les channels -->
        <div class="absolute left-40 top-88 transform -translate-y-1/2">
          <div
            id="carousel-grid"
            class="grid grid-cols-9 gap-x-[0px] gap-y-[10px] w-[3330px] transition-transform duration-800 ease-in-out ml-8"
          >
            <!-- Ligne 1 - Channels 1-9 -->
            <ChannelProjet
              isEmpty={false}
              projectCover="/src/assets/images/asafram_cover.svg"
              projectTitle="ASAFRAM"
              size="desktop"
              href="/projets/asafram"
            />
            <ChannelProjet
              isEmpty={false}
              projectCover="/src/assets/images/rba_cover.svg"
              projectTitle="Réseau Biodiversité pour les Abeilles"
              size="desktop"
              href="#"
            />
            <ChannelProjet
              isEmpty={false}
              projectCover="/src/assets/images/mysubs_cover.svg"
              projectTitle="MySubs"
              size="desktop"
              href="#"
            />
            <ChannelProjet
              isEmpty={false}
              projectCover="/src/assets/images/mmi_soccer_cover.svg"
              projectTitle="MMI Soccer"
              size="desktop"
              href="#"
            />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet 
              isEmpty={false}
              projectCover="/src/assets/images/test-img.jpeg"
              projectTitle="Test Image"
              size="desktop"
              href="#"
            />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />

            <!-- Ligne 2 - Channels 10-18 -->
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />

            <!-- Ligne 3 - Channels 19-27 -->
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
            <ChannelProjet isEmpty={true} size="desktop" />
          </div>
        </div>

        <!-- Flèche de navigation à droite -->
        <div
          class="absolute right-24 top-90 z-30 cursor-pointer"
          id="arrow-right"
        >
          <Fleche direction="droite" size="desktop" />
        </div>

        <!-- Flèche de navigation à gauche -->
        <div
          class="absolute left-24 top-90 transform -translate-y-1/2 z-30 cursor-pointer opacity-0"
          id="arrow-left"
        >
          <Fleche direction="gauche" size="desktop" />
        </div>
      </div>
    </main>

    <!-- Footer Desktop -->
    <FooterAccueil />
  </div>

  <!-- Version Mobile -->
  <div class="block md:hidden">
    <!-- Footer mobile -->
    <FooterAccueilMobile />
  </div>

  <!-- CvOverlay -->
  <CvOverlay client:load />

  <!-- ContactOverlay -->
  <ContactOverlay client:load />

  <!-- ParametresOverlay -->
  <ParametresOverlay client:load />

  <!-- PresentationOverlay -->
  <PresentationOverlay client:load />
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    let currentPage = 1;
    const carouselGrid = document.getElementById("carousel-grid");
    const arrowRight = document.getElementById("arrow-right");
    const arrowLeft = document.getElementById("arrow-left");

    let cvOverlayVisible = false;
    let contactOverlayVisible = false;
    let parametresOverlayVisible = false;
    let presentationOverlayVisible = false;

    function openParametresOverlay() {
      console.log("Ouverture des Paramètres");
      parametresOverlayVisible = true;
      const parametresOverlay = document.querySelector(".parametres-overlay");
      if (parametresOverlay) {
        parametresOverlay.classList.remove(
          "opacity-0",
          "pointer-events-none",
          "hidden"
        );
        parametresOverlay.classList.add("opacity-100", "pointer-events-auto");
      }
    }

    function closeParametresOverlay() {
      console.log("Fermeture des Paramètres");
      parametresOverlayVisible = false;
      const parametresOverlay = document.querySelector(".parametres-overlay");
      if (parametresOverlay) {
        parametresOverlay.classList.add("opacity-0", "pointer-events-none");
        parametresOverlay.classList.remove(
          "opacity-100",
          "pointer-events-auto"
        );
      }
    }

    function openContactOverlay() {
      console.log("Ouverture du Contact");
      contactOverlayVisible = true;
      const contactOverlay = document.querySelector(".contact-overlay");
      if (contactOverlay) {
        contactOverlay.classList.remove(
          "opacity-0",
          "pointer-events-none",
          "hidden"
        );
        contactOverlay.classList.add("opacity-100", "pointer-events-auto");
      }
    }

    function closeContactOverlay() {
      console.log("closeContactOverlay appelée");
      contactOverlayVisible = false;
      const contactOverlay = document.querySelector(".contact-overlay");
      if (contactOverlay) {
        console.log("Overlay trouvé, fermeture...");
        contactOverlay.classList.add("opacity-0", "pointer-events-none");
        contactOverlay.classList.remove("opacity-100", "pointer-events-auto");
        console.log("Classes après fermeture:", contactOverlay.className);
      } else {
        console.log("Overlay non trouvé!");
      }
    }

    function openCvOverlay() {
      console.log("Ouverture du CV");
      cvOverlayVisible = true;
      const cvOverlay = document.querySelector(".cv-overlay");
      if (cvOverlay) {
        console.log("CV Overlay trouvé, ouverture...");
        cvOverlay.classList.remove(
          "opacity-0",
          "pointer-events-none",
          "hidden"
        );
        cvOverlay.classList.add("opacity-100", "pointer-events-auto");
        console.log("Classes:", cvOverlay.className);
      } else {
        console.log("CV Overlay non trouvé !");
      }
    }

    function closeCvOverlay() {
      cvOverlayVisible = false;
      const cvOverlay = document.querySelector(".cv-overlay");
      if (cvOverlay) {
        cvOverlay.classList.add("opacity-0", "pointer-events-none");
        cvOverlay.classList.remove("opacity-100", "pointer-events-auto");
      }
    }

    function openPresentationOverlay() {
      console.log("Ouverture de la Présentation");
      presentationOverlayVisible = true;
      const presentationOverlay = document.querySelector(
        ".presentation-overlay"
      );
      if (presentationOverlay) {
        presentationOverlay.classList.remove(
          "opacity-0",
          "pointer-events-none",
          "hidden"
        );
        presentationOverlay.classList.add("opacity-100", "pointer-events-auto");
      }
    }

    function closePresentationOverlay() {
      console.log("Fermeture de la Présentation");
      presentationOverlayVisible = false;
      const presentationOverlay = document.querySelector(
        ".presentation-overlay"
      );
      if (presentationOverlay) {
        presentationOverlay.classList.add("opacity-0", "pointer-events-none");
        presentationOverlay.classList.remove(
          "opacity-100",
          "pointer-events-auto"
        );
      }
    }

    document.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;
      if (target.closest(".card-cv")) {
        e.preventDefault();
        openCvOverlay();
      } else if (
        target.closest("#cv-return-button") ||
        target.closest("#cv-close-button")
      ) {
        closeCvOverlay();
      } else if (target.closest(".cv-overlay > div")) {
        closeCvOverlay();
      } else if (target.closest("#contact-button")) {
        e.preventDefault();
        openContactOverlay();
      } else if (target.closest("#contact-return-button")) {
        console.log("Fermeture du Contact");
        closeContactOverlay();
      } else if (target.closest("#parametres-button")) {
        e.preventDefault();
        openParametresOverlay();
      } else if (
        target.closest("#parametres-close-button") ||
        target.closest("#parametres-close-button button")
      ) {
        closeParametresOverlay();
      } else if (target.closest('button[data-type="presentation"]')) {
        e.preventDefault();
        openPresentationOverlay();
      } else if (target.closest("#presentation-return-button")) {
        closePresentationOverlay();
      }
    });

    // Fonction pour changer de page
    function switchPage(pageNumber: number) {
      console.log("Changement vers la page:", pageNumber);
      if (pageNumber === 1) {
        if (carouselGrid) carouselGrid.style.transform = "translateX(0)";
        if (arrowRight) arrowRight.style.opacity = "1";
        if (arrowLeft) arrowLeft.style.opacity = "0";
        currentPage = 1;
        console.log("Page 1 active");
      } else if (pageNumber === 2) {
        if (carouselGrid) carouselGrid.style.transform = "translateX(-1890px)"; // Décalage de 4.5 colonnes (9 channels)
        if (arrowRight) arrowRight.style.opacity = "0";
        if (arrowLeft) arrowLeft.style.opacity = "1";
        currentPage = 2;
        console.log("Page 2 active");
      }
    }

    // Initialisation - Page 1 active par défaut
    if (arrowLeft) {
      arrowLeft.style.opacity = "0";
    }
    if (arrowRight) {
      arrowRight.addEventListener("click", () => {
        switchPage(2);
      });
    }

    // Navigation vers la page 1 (flèche gauche)
    if (arrowLeft) {
      arrowLeft.addEventListener("click", () => {
        switchPage(1);
      });
    }

    // Navigation au clavier
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight" && currentPage === 1) {
        switchPage(2);
      } else if (e.key === "ArrowLeft" && currentPage === 2) {
        switchPage(1);
      }
    });
  });
</script>

<style>
  @keyframes bounce-right {
    0%, 100% {
      transform: translateX(0) translateY(-50%);
      animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
    }
    50% {
      transform: translateX(25%) translateY(-50%);
      animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
    }
  }

  #arrow-right {
    animation: bounce-right 1.5s infinite;
    transform: translateY(-50%);
  }
</style>
