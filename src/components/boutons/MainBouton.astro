---
import IconRetour from "../../assets/icones/retour.webp";
import IconDezoom from "../../assets/icones/dezoom.webp";
import IconEnveloppe from "../../assets/icones/enveloppe.svg";
import FormeBouton from "../../assets/icones/forme_main_bouton.svg";

export interface Props {
  type: "retour" | "contact" | "presentation" | "dezoom";
  size?: "mobile" | "desktop" | "footer";
  href?: string;
  onClick?: () => void;
  id?: string;
  strokeColor?: string;
  neonColor?: string;
}

const {
  type,
  size = "desktop",
  href = "#",
  onClick,
  id,
  strokeColor,
  neonColor = "var(--color-light-blue)",
} = Astro.props;

const icons = {
  retour: IconRetour,
  contact: IconEnveloppe,
  dezoom: IconDezoom,
  presentation: null, // On le fera plus tard
};

// Tailles dynamiques
const sizes = {
  mobile: {
    button: "w-[76px] h-[76px]",
    shape: "w-8 h-8",
    icon: "w-8 h-8",
    iconRetour: "w-8 h-6",
    text: "text-sm",
  },
  desktop: {
    button: "w-[110px] h-[110px]",
    shape: "w-12 h-12",
    icon: "w-8 h-8",
    iconRetour: "w-[50px] h-[36px]",
    text: "text-xs",
  },
  footer: {
    button: "w-[155px] h-[155px]",
    shape: "w-20 h-20",
    icon: "w-[95px] h-[65px]",
    iconRetour: "w-20 h-14",
    text: "text-sm",
  },
};

const currentSize = sizes[size] || sizes.desktop;
---

<button
  class={`relative cursor-pointer transition-transform duration-200 ease-in-out border-none bg-none p-0 hover:scale-105 ${currentSize.button}`}
  data-type={type}
  id={id ||
    (type === "contact"
      ? "contact-button"
      : type === "retour"
        ? "cv-return-button"
        : undefined)}
  data-onclick={onClick ? "true" : undefined}
>
  <div
    class="w-full h-full rounded-full relative overflow-hidden flex items-center justify-center wii-main-button__circle"
    style={`--neon-color: ${neonColor};${strokeColor ? ` border-color: ${strokeColor};` : ""}`}
  >
    {/* Forme décorative en arrière-plan */}
    <div
      class={`absolute top-1 left-1 wii-main-button__shape ${currentSize.shape}`}
    >
      <FormeBouton class="w-full h-full" />
    </div>

    {/* Icônes */}
    {
      type === "retour" && (
        <img
          src="/src/assets/icones/retour.webp"
          class={`wii-main-button__icon relative z-10 ${currentSize.iconRetour}`}
          alt="Retour"
        />
      )
    }
    {
      type === "contact" && (
        <IconEnveloppe
          class={`wii-main-button__icon relative z-10 ${currentSize.icon}`}
        />
      )
    }
    {
      type === "dezoom" && (
        <img
          src="/src/assets/icones/dezoom.webp"
          class={`wii-main-button__icon relative z-10 ${currentSize.icon}`}
          alt="Dézoom"
        />
      )
    }
    {
      type === "presentation" && (
        <div
          class={`bg-[var(--color-light-gray)] rounded-full flex items-center justify-center relative z-10 ${currentSize.icon}`}
        >
          <span class={`text-[var(--color-dark-gray)] ${currentSize.text}`}>
            Mii
          </span>
        </div>
      )
    }
  </div>
</button>

<style>
  /* Focus ring supprimé */
  button:focus {
    outline: none;
    box-shadow: none;
  }

  .wii-main-button__circle {
    /* État normal */
    background-color: var(--color-light-gray); /* Couleur du Figma */
    border-color: var(--neon-color, var(--color-light-blue));
    border-width: 3px;
    border-style: solid;

    /* Ombres du Figma + effet néon ultra léger permanent */
    box-shadow:
      inset -4px -4px 9.5px rgba(0, 0, 0, 0.26),
      5.8px 8.7px 0px rgba(186, 188, 193, 1);
    
    transition: box-shadow 0.3s ease-out;
  }

  /* Animation de pulsation subtile sur le néon uniquement */
  .wii-main-button__circle::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    animation: button-glow-pulse 3s ease-in-out infinite;
  }

  .wii-main-button__icon {
    color: var(--color-dark-gray); /* Couleur grise du Figma */
  }

  .wii-main-button__shape {
    z-index: 1; /* Derrière l'icône */
    color: #ecebeb; /* Couleur bleue Wii */
  }

  /* État actif */
  button:active .wii-main-button__circle {
    transform: translateY(1px);
    box-shadow:
      inset -4px -4px 9.5px rgba(0, 0, 0, 0.26),
      4.8px 7.7px 0px rgba(186, 188, 193, 1);
  }
</style>

<script define:vars={{ neonColorProp: neonColor }}>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll('button[data-onclick="true"]');

    buttons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const type = button.getAttribute("data-type");

        switch (type) {
          case "retour":
            console.log("Retour cliqué");
            break;
          case "contact":
            console.log("Contact cliqué");
            break;
          case "dezoom":
            console.log("Dézoom cliqué");
            break;
          case "presentation":
            console.log("Présentation cliqué");
            break;
        }
      });
    });

    // Applique les effets néon avec la couleur personnalisée
    document.querySelectorAll('.wii-main-button__circle').forEach((circle) => {
      const neonColor = getComputedStyle(circle).getPropertyValue('--neon-color').trim();
      
      if (neonColor && !neonColor.includes('--color-light-blue')) {
        // Créer une keyframe dynamique pour cette couleur
        const styleSheet = document.styleSheets[0];
        const keyframeName = `button-glow-pulse-${Math.random().toString(36).substr(2, 9)}`;
        
        const keyframes = `
          @keyframes ${keyframeName} {
            0%, 100% {
              box-shadow: 0 0 2px ${neonColor}, 0 0 4px ${neonColor};
            }
            50% {
              box-shadow: 0 0 4px ${neonColor}, 0 0 8px ${neonColor};
            }
          }
        `;
        
        try {
          styleSheet.insertRule(keyframes, styleSheet.cssRules.length);
          const afterElement = circle.querySelector('::after') || circle;
          circle.style.setProperty('animation-name', keyframeName);
          
          // Applique aussi le hover dynamique
          const parent = circle.closest('button');
          if (parent) {
            parent.addEventListener('mouseenter', () => {
              circle.style.boxShadow = `inset -4px -4px 9.5px rgba(0, 0, 0, 0.26), 5.8px 8.7px 0px rgba(186, 188, 193, 1), 0 0 6px ${neonColor}, 0 0 12px ${neonColor}`;
            });
            parent.addEventListener('mouseleave', () => {
              circle.style.boxShadow = '';
            });
          }
        } catch (e) {
          console.warn('Could not create dynamic keyframe:', e);
        }
      }
    });
  });
</script>
