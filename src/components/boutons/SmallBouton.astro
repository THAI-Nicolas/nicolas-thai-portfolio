---
import IconTelechargement from "../../assets/icones/telechargement.svg";
import IconZoom from "../../assets/icones/zoom.svg";
import IconParametres from "../../assets/icones/parametres.svg";

export interface Props {
  type: "parametres" | "telechargement" | "zoom" | "dezoom";
  href?: string;
  size?: "mobile" | "desktop" | "footer";
  onClick?: () => void;
  id?: string;
}

const { type, href = "#", size = "desktop", onClick, id } = Astro.props;

// Lien de téléchargement du CV si type = telechargement
const downloadHref = type === "telechargement" ? "/cv_nicolas_thai.pdf" : href;
const isDownload = type === "telechargement";

// Tailles dynamiques
const sizes = {
  mobile: {
    button: "w-[50px] h-[50px]",
    icon: "w-6 h-6",
  },
  desktop: {
    button: "w-[60px] h-[60px]",
    icon: "w-[28px] h-[28px]",
  },
  footer: {
    button: "w-[80px] h-[80px]",
    icon: "w-[40px] h-[40px]",
  },
};

const currentSize = sizes[size] || sizes.desktop;

const icons = {
  parametres: IconParametres,
  telechargement: IconTelechargement,
  zoom: IconZoom,
  dezoom: null, // Géré séparément car c'est un .webp
};

const Element = isDownload ? 'a' : 'button';
---

{isDownload ? (
  <a
    href={downloadHref}
    download="CV_Nicolas_THAI.pdf"
    class={`relative cursor-pointer transition-all duration-200 ease-in-out border-none bg-none p-0 ${currentSize.button} block`}
    data-type={type}
    id={id}
  >
    <div
      class="w-full h-full rounded-full relative overflow-hidden flex items-center justify-center wii-button__circle"
    >
      {
        type === "telechargement" && (
          <IconTelechargement
            class={`transition-colors duration-200 wii-button__icon ${currentSize.icon}`}
          />
        )
      }
    </div>
  </a>
) : (
  <button
    class={`relative cursor-pointer transition-all duration-200 ease-in-out border-none bg-none p-0 ${currentSize.button}`}
    data-type={type}
    data-onclick={onClick ? "true" : undefined}
    id={id}
  >
    <div
      class="w-full h-full rounded-full relative overflow-hidden flex items-center justify-center wii-button__circle"
    >
      {
        type === "parametres" && (
          <IconParametres
            class={`transition-colors duration-200 wii-button__icon ${currentSize.icon}`}
          />
        )
      }
      {
        type === "zoom" && (
          <IconZoom
            class={`transition-colors duration-200 wii-button__icon ${currentSize.icon}`}
          />
        )
      }
      {
        type === "dezoom" && (
          <img
            src="/icones/dezoom.webp"
            class={`transition-colors duration-200 wii-button__icon ${currentSize.icon}`}
            alt="Dézoom"
          />
        )
      }
    </div>
  </button>
)}

<style>
  /* Focus ring personnalisé */
  a:focus,
  button:focus {
    outline: none;
    box-shadow: none;
  }

  .wii-button__circle {
    /* État normal */
    background-color: var(--color-background);
    border: 2px solid var(--color-light-blue);

    /* Ombres + effet néon ultra léger permanent */
    box-shadow:
      inset 0 5px 5px rgba(0, 0, 0, 0.25),
      0 5px 5px rgba(0, 0, 0, 0.25),
      0 0 2px rgba(52, 190, 237, 0.6),
      0 0 4px rgba(52, 190, 237, 0.5);
    
    transition: all 0.3s ease-out;
    animation: button-glow-pulse 3s ease-in-out infinite;
  }

  .wii-button__icon {
    color: var(--color-dark-gray);
  }

  /* Pour l'image dezoom, utiliser un filtre */
  .wii-button__icon[src] {
    filter: brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(0%)
      hue-rotate(0deg) brightness(100%) contrast(100%);
  }

  /* État hover avec effet néon */
  a:hover .wii-button__circle,
  button:hover .wii-button__circle {
    background-color: var(--color-light-blue);
    border-color: var(--color-light-blue);
    box-shadow:
      inset 0 5px 5px rgba(0, 0, 0, 0.25),
      0 5px 5px rgba(0, 0, 0, 0.25),
      0 0 6px rgba(52, 190, 237, 0.7),
      0 0 12px rgba(52, 190, 237, 0.5);
    animation: none;
  }

  /* Animation de pulsation subtile */
  @keyframes button-glow-pulse {
    0%, 100% {
      box-shadow:
        inset 0 5px 5px rgba(0, 0, 0, 0.25),
        0 5px 5px rgba(0, 0, 0, 0.25),
        0 0 2px rgba(52, 190, 237, 0.6),
        0 0 4px rgba(52, 190, 237, 0.5);
    }
    50% {
      box-shadow:
        inset 0 5px 5px rgba(0, 0, 0, 0.25),
        0 5px 5px rgba(0, 0, 0, 0.25),
        0 0 4px rgba(52, 190, 237, 0.7),
        0 0 8px rgba(52, 190, 237, 0.6);
    }
  }

  a:hover .wii-button__icon,
  button:hover .wii-button__icon {
    color: white;
  }

  a:hover .wii-button__icon[src],
  button:hover .wii-button__icon[src] {
    filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(0%)
      hue-rotate(0deg) brightness(100%) contrast(100%);
  }

  /* État actif */
  button:active .wii-button__circle {
    transform: translateY(1px);
    box-shadow:
      inset 0 3px 3px rgba(0, 0, 0, 0.25),
      0 3px 3px rgba(0, 0, 0, 0.25);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll('button[data-onclick="true"]');

    buttons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const type = button.getAttribute("data-type");

        switch (type) {
          case "parametres":
            console.log("Paramètres cliqué");
            break;
          case "telechargement":
            console.log("Téléchargement cliqué");
            break;
          case "zoom":
            console.log("Zoom cliqué");
            break;
          case "dezoom":
            console.log("Dézoom cliqué");
            break;
        }
      });
    });
  });
</script>
