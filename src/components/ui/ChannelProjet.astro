---
export interface Props {
  isEmpty?: boolean;
  projectCover?: string;
  projectTitle?: string;
  size?: "mobile" | "desktop";
  href?: string;
  onClick?: () => void;
  isPriority?: boolean;
}

const {
  isEmpty = true,
  projectCover,
  projectTitle,
  size = "desktop",
  href = "#",
  onClick,
  isPriority = false,
} = Astro.props;

// Tailles dynamiques avec clamp() fluide + limitation par hauteur viewport
const sizes = {
  mobile: {
    container: "channel-mobile w-[clamp(17rem,45vw,18.4375rem)] h-[clamp(9rem,24vw,10rem)]",
  },
  desktop: {
    container: "channel-fluid w-[clamp(12rem,min(20vw,37vh),26rem)] h-[clamp(7.5rem,min(10vw,22vh),15rem)]",
  },
};

const currentSize = sizes[size] || sizes.desktop;
---

{
  href && href !== "#" ? (
    <a
      href={href}
      class={`block ${currentSize.container} cursor-pointer group relative`}
    >
      {/* Container principal style Wii Channel */}
      <div class="relative w-full h-full wii-channel-container overflow-hidden flex items-center justify-center">
        {/* Fond avec effet bruit TV */}
        <div class={`absolute inset-0 ${isEmpty ? 'wii-channel-bg' : 'wii-channel-bg-static'}`}></div>
        
        {/* Bordure */}
        <div class="absolute inset-0 wii-channel-border pointer-events-none"></div>
        
        {/* Zone de contenu (image) */}
        <div class="absolute inset-[2px] z-10 flex items-center justify-center overflow-hidden rounded-[26px_/_48px] bg-[#CBCBCB]">
          {!isEmpty && projectCover && (
            <img
              src={projectCover}
              alt={projectTitle || "Project cover"}
              class="w-full h-full object-cover scale-[1.02] transition-transform duration-300 ease-out group-hover:scale-105"
              fetchpriority={isPriority ? "high" : undefined}
              loading={isPriority ? "eager" : "lazy"}
            />
          )}
        </div>
      </div>
      
      {/* Bulle de titre au survol (style Wii) */}
      {!isEmpty && projectTitle && (
        <div class="wii-title-bubble absolute -bottom-14 left-1/2 opacity-0 group-hover:opacity-100 pointer-events-none transition-all duration-300 ease-out group-hover:translate-y-0 translate-y-2 z-50" style="transform: translateX(-50%); width: 380px;">
          <div class="relative bg-white dark:bg-gray-800 rounded-full px-6 py-3 border-2 border-gray-300" style="box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15), 0 2px 6px rgba(0, 0, 0, 0.1);">
            <span style="font-family: 'raleway', sans-serif;" class="relative z-10 text-text-gray dark:text-white font-medium text-lg tracking-wide text-center block truncate">
              {projectTitle}
            </span>
          </div>
        </div>
      )}
    </a>
  ) : (
    <div
      class={`${currentSize.container} cursor-pointer group relative`}
      data-onclick={onClick ? "true" : undefined}
    >
      {/* Container principal style Wii Channel */}
      <div class="relative w-full h-full wii-channel-container overflow-hidden flex items-center justify-center">
        {/* Fond avec effet bruit TV */}
        <div class={`absolute inset-0 ${isEmpty ? 'wii-channel-bg' : 'wii-channel-bg-static'}`}></div>
        
        {/* Bordure */}
        <div class="absolute inset-0 wii-channel-border pointer-events-none"></div>
        
        {/* Zone de contenu (image) */}
        <div class="absolute inset-[2px] z-10 flex items-center justify-center overflow-hidden rounded-[26px_/_48px] bg-[#CBCBCB]">
          {!isEmpty && projectCover && (
            <img
              src={projectCover}
              alt={projectTitle || "Project cover"}
              class="w-full h-full object-cover scale-[1.02] transition-transform duration-300 ease-out group-hover:scale-105"
              fetchpriority={isPriority ? "high" : undefined}
              loading={isPriority ? "eager" : "lazy"}
            />
          )}
        </div>
      </div>

      {/* Bulle de titre au survol (style Wii) */}
      {!isEmpty && projectTitle && (
        <div class="wii-title-bubble absolute -bottom-14 left-1/2 opacity-0 group-hover:opacity-100 pointer-events-none transition-all duration-300 ease-out group-hover:translate-y-0 translate-y-2 z-50" style="transform: translateX(-50%); width: 380px;">
          <div class="relative bg-white dark:bg-gray-800 rounded-full px-6 py-3 border-2 border-gray-300" style="box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15), 0 2px 6px rgba(0, 0, 0, 0.1);">
            <span style="font-family: 'raleway', sans-serif;" class="relative z-10 text-text-gray dark:text-white font-medium text-xl tracking-wide text-center block truncate">
              {projectTitle}
            </span>
          </div>
        </div>
      )}
    </div>
  )
}

<style>
  /* Animations définies dans animations.css */
  
  /* Appliquer l'animation uniquement aux images de projets (non-empty) */
  .group:not(:has(.wii-channel-bg)) img {
    animation-duration: 5s;
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
  }

  /* Directions aléatoires pour chaque channel */
  .group:nth-child(1) img { animation-name: float-up; animation-delay: 0s; }
  .group:nth-child(2) img { animation-name: float-right; animation-delay: 0.5s; }
  .group:nth-child(3) img { animation-name: float-diagonal-tl; animation-delay: 1s; }
  .group:nth-child(4) img { animation-name: float-left; animation-delay: 1.5s; }
  .group:nth-child(5) img { animation-name: float-down; animation-delay: 2s; }
  .group:nth-child(6) img { animation-name: float-diagonal-br; animation-delay: 2.5s; }
  .group:nth-child(7) img { animation-name: float-up; animation-delay: 3s; }
  .group:nth-child(8) img { animation-name: float-diagonal-tr; animation-delay: 3.5s; }
  .group:nth-child(9) img { animation-name: float-right; animation-delay: 4s; }
  .group:nth-child(10) img { animation-name: float-diagonal-bl; animation-delay: 0.3s; }
  .group:nth-child(11) img { animation-name: float-left; animation-delay: 0.8s; }
  .group:nth-child(12) img { animation-name: float-up; animation-delay: 1.3s; }
  .group:nth-child(13) img { animation-name: float-down; animation-delay: 1.8s; }
  .group:nth-child(14) img { animation-name: float-diagonal-tr; animation-delay: 2.3s; }
  .group:nth-child(15) img { animation-name: float-right; animation-delay: 2.8s; }
  .group:nth-child(16) img { animation-name: float-diagonal-bl; animation-delay: 3.3s; }
  .group:nth-child(17) img { animation-name: float-left; animation-delay: 3.8s; }
  .group:nth-child(18) img { animation-name: float-up; animation-delay: 4.3s; }
  .group:nth-child(19) img { animation-name: float-diagonal-br; animation-delay: 0.6s; }
  .group:nth-child(20) img { animation-name: float-down; animation-delay: 1.1s; }
  .group:nth-child(21) img { animation-name: float-right; animation-delay: 1.6s; }
  .group:nth-child(22) img { animation-name: float-diagonal-tl; animation-delay: 2.1s; }
  .group:nth-child(23) img { animation-name: float-left; animation-delay: 2.6s; }
  .group:nth-child(24) img { animation-name: float-up; animation-delay: 3.1s; }
  .group:nth-child(25) img { animation-name: float-diagonal-tr; animation-delay: 3.6s; }
  .group:nth-child(26) img { animation-name: float-down; animation-delay: 4.1s; }
  .group:nth-child(27) img { animation-name: float-diagonal-bl; animation-delay: 4.6s; }

  /* Pause de l'animation idle au hover */
  .group:hover img {
    animation-play-state: paused;
  }

  /* Container principal style Wii */
  .wii-channel-container {
    position: relative;
    border-radius: 28px / 50px;
    transition: filter 0.3s ease-out;
  }

  /* Effet néon très léger sur tout le container au hover */
  .group:hover .wii-channel-container {
    filter: drop-shadow(0 0 4px rgba(52, 190, 237, 0.3)) 
            drop-shadow(0 0 8px rgba(52, 190, 237, 0.2));
  }

  /* Fond gris lisse pour tous les blocs */
  .wii-channel-bg-static,
  .wii-channel-bg {
    background-color: #CBCBCB;
    border-radius: 28px / 50px;
  }

  /* Bordure style Wii - forme bombée TV */
  .wii-channel-border {
    box-shadow: inset 0 0 0 1.4px #a2a2a2;
    transition: box-shadow 0.3s ease-out;
    border-radius: 28px / 50px;
  }

  /* Hover effect sur la bordure - plus épaisse et light blue avec glow néon visible */
  .group:hover .wii-channel-border {
    box-shadow: 
      inset 0 0 0 3px var(--color-light-blue),
      0 0 8px var(--color-light-blue),
      0 0 16px var(--color-light-blue),
      0 0 24px rgba(52, 190, 237, 0.3);
  }

  /* Bulle de titre style Wii */
  .wii-title-bubble {
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.2));
  }

  /* Délai d'apparition au survol */
  .group:hover .wii-title-bubble {
    transition-delay: 0.1s;
  }

  /* Animation de pulsation subtile pour la bulle */
  @keyframes bubble-pulse {
    0%, 100% {
      transform: translateX(-50%) scale(1);
    }
    50% {
      transform: translateX(-50%) scale(1.02);
    }
  }

  .group:hover .wii-title-bubble {
    animation: bubble-pulse 2.5s ease-in-out infinite;
    animation-delay: 0.5s;
  }

  /* Focus ring supprimé */
  div:focus {
    outline: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const channels = document.querySelectorAll('div[data-onclick="true"]');

    channels.forEach((channel) => {
      channel.addEventListener("click", (e) => {
        console.log("Channel cliqué");
      });
    });
  });
</script>
