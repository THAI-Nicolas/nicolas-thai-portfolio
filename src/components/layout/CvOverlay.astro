---
import Cv from "../ui/Cv.astro";
import MainBouton from "../boutons/MainBouton.astro";
import SmallBouton from "../boutons/SmallBouton.astro";
import ContactBouton from "../boutons/ContactBouton.astro";
import Fleche from "../ui/Fleche.astro";
import Socle from "../ui/Socle.astro";

export interface Props {
  isVisible?: boolean;
  onClose?: () => void;
}

const { isVisible = false, onClose } = Astro.props;
---

<div
  class="cv-overlay opacity-0 pointer-events-none fixed inset-0 z-[60]"
  style="transition: opacity 0.3s ease-in-out;"
>
  <div class="bg-black/50 fixed inset-0 z-[70] overflow-hidden"></div>

  <div
    class="cv-container fixed inset-0 z-[80] flex items-center justify-start"
    style="padding-left: 80px; padding-right: 80px;"
  >
    <div class="flex items-stretch gap-12">
      <!-- Partie 1 : MainBouton retour + Boutons Contact -->
      <div
        class="flex flex-col items-center justify-between flex-shrink-0 mt-8 mb-4 ml-8"
      >
        <div id="cv-return-button">
          <MainBouton type="retour" size="desktop" />
        </div>
        <div class="flex flex-col items-center gap-8">
          <ContactBouton type="email" />
          <ContactBouton type="github" />
          <ContactBouton type="linkedin" />
          <ContactBouton type="instagram" />
        </div>
      </div>

      <!-- Partie 2 : CV + SmallBouton téléchargement -->
      <div class="relative flex-shrink-0 flex items-start ml-12">
        <div class="relative w-[600px]">
          <div class="absolute top-10 right-4 z-10">
            <SmallBouton type="telechargement" size="desktop" />
          </div>
          <Cv />
        </div>
      </div>

      <!-- Partie 3 : Socle + Mii -->
      <div
        class="relative flex-shrink-0 flex items-center justify-center -ml-12"
      >
        <div class="relative w-96 h-96">
          <div
            class="neon-circle-outer absolute top-40 left-125 transform -translate-x-1/2 -translate-y-1/2 w-[784px] h-[784px]"
          >
          </div>

          <div
            class="absolute bottom-55 left-125 transform -translate-x-1/2 scale-130 flex gap-96 items-center cursor-pointer"
          >
            <div>
              <Fleche direction="gauche" size="mobile" />
            </div>
            <div>
              <Fleche direction="droite" size="mobile" />
            </div>
          </div>

          <div
            class="mii-container absolute top-0 left-1/2 transform -translate-x-1/2 z-10 flex items-center justify-center w-32 h-32"
          >
          </div>

          <div
            class="socle-with-shadow absolute top-100 left-50 z-20"
            style="width: 600px; height: 100px;"
          >
            <div class="relative w-full h-full">
              <div
                class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full h-4 bg-black/30 blur-md rounded-full"
              >
              </div>
              <div class="relative z-10 w-full h-full">
                <Socle />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .cv-overlay {
    transition: opacity 0.3s ease-in-out;
  }

  .cv-container {
    scrollbar-width: thin;
  }

  .neon-circle-outer {
    background: rgba(255, 255, 255, 0.7);
    border: 10.747px solid #34beed;
    border-radius: 50%;
    filter: drop-shadow(0 0 32.16px rgba(52, 190, 237, 1));
    box-shadow: 0 0 32.16px rgba(52, 190, 237, 1);
  }
</style>

<script>
  function initCvOverlay() {
    const returnButton = document.getElementById("cv-return-button");
    const cvOverlay = document.querySelector(".cv-overlay");

    if (returnButton && cvOverlay) {
      returnButton.addEventListener("click", () => {
        cvOverlay.classList.add("opacity-0", "pointer-events-none");
        cvOverlay.classList.remove("opacity-100", "pointer-events-auto");
      });
    }
  }

  document.addEventListener("DOMContentLoaded", initCvOverlay);
  document.addEventListener("astro:page-load", initCvOverlay);
</script>
