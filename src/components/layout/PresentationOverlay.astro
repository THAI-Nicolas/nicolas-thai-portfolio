---
import MainBouton from "../boutons/MainBouton.astro";
import TechnologiesPresentation from "../ui/TechnologiesPresentation.astro";
import { TechnologiesService } from "../../../backend/services/technologies.service";

export interface Props {
  isVisible?: boolean;
  onClose?: () => void;
}

const { isVisible = false, onClose } = Astro.props;

const allTechnologies = await TechnologiesService.getAll();
const formattedTechnologies =
  TechnologiesService.formatTechnologiesForPresentation(allTechnologies);

const frontendNames = ["Astro", "TailwindCSS", "Javascript"];
const backendNames = ["PocketBase", "MySQL"];

const technologiesFrontend = formattedTechnologies.filter((tech) =>
  frontendNames.includes(tech.nom)
);

const technologiesBackend = formattedTechnologies.filter((tech) =>
  backendNames.includes(tech.nom)
);
---

<div
  class="presentation-overlay opacity-0 pointer-events-none fixed inset-0 z-[60]"
  style="transition: opacity 0.3s ease-in-out;"
>
  <div class="bg-black/50 fixed inset-0 z-[70]"></div>

  <div
    class="presentation-container fixed inset-0 z-[80] flex items-center justify-center"
  >
    <!-- Bouton Retour -->
    <div class="absolute top-16 left-28 z-[100]" id="presentation-return-button">
      <MainBouton type="retour" size="desktop" />
    </div>

    <!-- Carte Livre Portfolio -->
    <div class="book-card" id="book-card">
      <!-- Page 1 (Couverture) -->
      <div class="book-page page-1" data-page="1">
        <div class="page-front">
          <div class="cover-content">
            <div class="cover-ornament">‚ú¶</div>
            <h2 class="cover-subtitle">PORTFOLIO</h2>
            <h1 class="cover-main-title">
              NICOLAS<br />
              <span class="name">THAI</span>
            </h1>
            <div class="cover-ornament">‚ú¶</div>
            <p class="cover-tagline">D√©veloppeur Web & Designer</p>
          </div>
        </div>
        <div class="page-back">
          <div class="presentation-card-container hidden">
            <div class="presentation-card">
              <div class="card-frame">
                <div class="card-image-container">
                  <img
                    src="/src/assets/images/image_mii_nico.png"
                    alt="Nicolas THAI"
                    class="card-avatar"
                  />
                </div>
              </div>

              <h3 class="card-name">Nicolas THAI (20 ans)</h3>

              <div class="card-info-list">
                <div class="card-info-item">
                  <svg
                    class="card-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path>
                    <circle cx="12" cy="10" r="3" stroke-width="2"></circle>
                  </svg>
                  <span>Audincourt (25400), France</span>
                </div>

                <div class="card-info-item">
                  <svg
                    class="card-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      d="M3 8L10.89 13.26C11.2187 13.4793 11.6049 13.5963 12 13.5963C12.3951 13.5963 12.7813 13.4793 13.11 13.26L21 8M5 19H19C19.5304 19 20.0391 18.7893 20.4142 18.4142C20.7893 18.0391 21 17.5304 21 17V7C21 6.46957 20.7893 5.96086 20.4142 5.58579C20.0391 5.21071 19.5304 5 19 5H5C4.46957 5 3.96086 5.21071 3.58579 5.58579C3.21071 5.96086 3 6.46957 3 7V17C3 17.5304 3.21071 18.0391 3.58579 18.4142C3.96086 18.7893 4.46957 19 5 19Z"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path>
                  </svg>
                  <span>Thainicolas06@gmail.com</span>
                </div>

                <div class="card-info-item">
                  <svg
                    class="card-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                    ></path>
                  </svg>
                  <span>Nicolas THAI</span>
                </div>

                <div class="card-info-item">
                  <svg
                    class="card-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"
                    ></path>
                  </svg>
                  <span>THAI-Nicolas</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Page 2 -->
      <div class="book-page page-2" data-page="2">
        <div class="page-front">
          <div class="page-right-content">
            <div class="intro-section">
              <h2 class="intro-title">SALUT, JE SUIS NICO !</h2>

              <div class="profile-card">
                <h3 class="profile-title">MON PROFIL</h3>
                <p>
                  Je suis un √©tudiant en 2√®me ann√©e de BUT MMI √† Montb√©liard, je
                  me forme actuellement pour devenir un d√©veloppeur polyvalent,
                  capable d'alli√© code, design (UX/UI, prototypages), marketing
                  et gestion de projet.
                </p>
                <p>
                  Curieux et autodidacte, j'aime apprendre par moi-m√™me,
                  participer √† de nouvelles id√©es et mettre mes comp√©tences au
                  service de projets innovants.
                </p>
              </div>

              <div class="welcome-section">
                <h3 class="welcome-title">BIENVENUE SUR MON PORTFOLIO !</h3>
                <p>
                  Vous √™tes ici pour d√©couvrir mes projets, mes comp√©tences et
                  ma fa√ßon de travailler. Vous y trouverez des r√©alisations qui
                  refl√®tent ma curiosit√©, ma cr√©ativit√© et ma passion pour le
                  d√©veloppement et le design.
                </p>
                <button class="discover-button">
                  D√âCOUVRE MES COMP√âTENCES
                  <svg
                    class="arrow-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      d="M5 12h14M12 5l7 7-7 7"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="page-back">
          <!-- Dos de la page 2 -->
        </div>
      </div>

      <!-- Page 3 -->
      <div class="book-page page-3" data-page="3">
        <div class="page-front">
          <div
            class="technologies-page-content tech-hidden w-full h-full bg-white p-12 flex flex-col gap-8"
          >
            <h2
              class="text-3xl font-black text-black m-0 tracking-wide font-raleway"
            >
              MES TECHNOLOGIES
            </h2>

            <div class="flex flex-col gap-6">
              <TechnologiesPresentation
                categorie="Frontend"
                technologies={technologiesFrontend}
              />

              <TechnologiesPresentation
                categorie="Backend"
                technologies={technologiesBackend}
              />
            </div>
          </div>
        </div>
        <div class="page-back">
          <!-- Dos de la page 3 -->
        </div>
      </div>

      <!-- Page 4 -->
      <div class="book-page page-4" data-page="4">
        <div class="page-front">
          <div class="page-content-empty">
            <!-- Contenu vide -->
          </div>
        </div>
        <div class="page-back">
          <!-- Dos de la page 4 -->
        </div>
      </div>
    </div>

    <!-- OLD - Pages int√©rieures cach√©es -->
    <div style="display: none;">
      <!-- TEMPORAIREMENT CACH√â POUR TEST -->
      <!-- Page 1 : Profil -->
      <div class="full-page page-1" data-page="1">
        <div class="page-box">
          <div class="page-bark"></div>
          <div class="page-content-wrapper">
            <div class="full-page-left">
              <h2 class="page-main-title">
                <span class="icon-deco">‚ú¶</span>
                SALUT, JE SUIS NICO !
                <span class="icon-deco">‚ú¶</span>
              </h2>

              <div class="mii-zone">
                <div class="mii-placeholder-box">
                  <div class="mii-text">[ MII CHARACTER ]</div>
                  <div class="mii-subtitle">√Ä venir...</div>
                </div>
              </div>
            </div>

            <div class="full-page-right">
              <div class="info-card">
                <div class="card-header">
                  <span class="emoji-icon">üìã</span>
                  <h3>MON PROFIL</h3>
                </div>
                <p>
                  Je suis un √©tudiant en 2√®me ann√©e de BUT MMI √† Montb√©liard, je
                  me forme actuellement pour devenir un d√©veloppeur polyvalent,
                  capable d'alli√© code, design (UX/UI, prototypages), marketing
                  et gestion de projet.
                </p>
                <p>
                  Curieux et autodidacte, j'aime apprendre par moi-m√™me,
                  participer √† de nouvelles id√©es et mettre mes comp√©tences au
                  service de projets innovants.
                </p>
              </div>

              <div class="welcome-card">
                <h4>BIENVENUE SUR MON PORTFOLIO !</h4>
                <p>
                  Vous √™tes ici pour d√©couvrir mes projets, mes comp√©tences et
                  ma fa√ßon de travailler.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Page 2 : D√©veloppement -->
      <div class="full-page page-2" data-page="2">
        <div class="page-box">
          <div class="page-bark"></div>
          <div class="page-content-wrapper">
            <div class="full-page-content">
              <div class="competence-section">
                <div class="competence-header dev">
                  <div class="icon-circle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path
                        d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                  </div>
                  <h2>D√âVELOPPEMENT</h2>
                </div>

                <div class="competence-list">
                  <div class="comp-item">
                    <span class="comp-badge frontend">FRONTEND</span>
                    <h4>Sites statiques modernes</h4>
                    <p>
                      Je r√©alise des sites statiques modernes avec Astro,
                      Tailwind CSS et JavaScript, en ajoutant des animations et
                      des interactions pour rendre l'exp√©rience utilisateur
                      vivante.
                    </p>
                  </div>

                  <div class="comp-item">
                    <span class="comp-badge backend">BACKEND</span>
                    <h4>Sites dynamiques</h4>
                    <p>
                      Je con√ßois des sites dynamiques capables de g√©rer des
                      bases de donn√©es avec MySQL, PocketBase ou PhpMyAdmin.
                    </p>
                  </div>

                  <div class="comp-item">
                    <span class="comp-badge cms">CMS</span>
                    <h4>WordPress</h4>
                    <p>
                      Je suis capable de cr√©er et personnaliser des sites sur
                      WordPress, en d√©veloppant des th√®mes et plugins.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Page 3 : Design -->
      <div class="full-page page-3" data-page="3">
        <div class="page-box">
          <div class="page-bark"></div>
          <div class="page-content-wrapper">
            <div class="full-page-content">
              <div class="competence-section">
                <div class="competence-header design">
                  <div class="icon-circle">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path
                        d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                  </div>
                  <h2>DESIGN</h2>
                </div>

                <div class="competence-list">
                  <div class="comp-item">
                    <span class="comp-badge design-badge">MAQUETTAGE</span>
                    <h4>Maquettes et prototypes</h4>
                    <p>
                      Je con√ßois des maquettes et prototypes de sites web et
                      d'applications mobiles sur Figma.
                    </p>
                  </div>

                  <div class="comp-item">
                    <span class="comp-badge design-badge">3D</span>
                    <h4>Mod√®les 3D</h4>
                    <p>
                      Je cr√©e des mod√®les 3D, principalement des personnages,
                      avec Blender et Mixamo.
                    </p>
                  </div>

                  <div class="comp-item">
                    <span class="comp-badge design-badge">COMMUNICATION</span>
                    <h4>Communication visuelle</h4>
                    <p>
                      Je r√©alise des dossiers de communication, visuels et
                      flyers sur Canva.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- FIN OLD -->
</div>

<style>
  .presentation-overlay {
    transition: opacity 0.3s ease-in-out;
  }

  .presentation-container {
    perspective: 2000px;
    perspective-origin: center center;
  }

  /* ========== CARTE LIVRE PORTFOLIO ========== */
  .book-card {
    position: relative;
    width: 600px;
    height: 800px;
    transform-style: preserve-3d;
    cursor: pointer;
    transition: transform 0.6s ease-out;
  }

  /* Centrage automatique quand le livre est ouvert */
  .book-card.opened {
    transform: translateX(300px);
  }

  /* √âpaisseur haut */
  .book-card::before {
    content: "";
    position: absolute;
    top: -5px;
    left: 0;
    width: 100%;
    height: 5px;
    background: #bac1ba;
    transform-origin: bottom;
    transform: skewX(-45deg);
    z-index: 100;
  }

  /* √âpaisseur droite */
  .book-card::after {
    content: "";
    position: absolute;
    top: 0;
    right: -5px;
    width: 5px;
    height: 100%;
    background: #92a29c;
    transform-origin: left;
    transform: skewY(-45deg);
    z-index: 100;
  }

  /* Pages individuelles */
  .book-page {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    transform-style: preserve-3d;
    transform-origin: left;
    transition: transform 0.7s ease-out;
  }

  .page-1 {
    z-index: 4;
  }
  .page-2 {
    z-index: 3;
  }
  .page-3 {
    z-index: 2;
  }
  .page-4 {
    z-index: 1;
  }

  /* Face avant de la page - Couverture */
  .page-1 .page-front {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    background: var(--color-light-blue);
    border-radius: 8px;
    border: 4px solid var(--color-light-blue);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  }

  /* Face avant de la page - Pages int√©rieures blanches */
  .page-2 .page-front,
  .page-3 .page-front,
  .page-4 .page-front {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    background: white;
    border-radius: 8px;
    border: 4px solid var(--color-light-blue);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  }

  /* Contenu vide des pages blanches */
  .page-content-empty {
    width: 100%;
    height: 100%;
  }

  /* Face arri√®re de la page */
  .page-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    background: white;
    border-radius: 8px;
    border: 4px solid var(--color-light-blue);
    transform: rotateY(180deg);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
  }

  /* Animation de tournement */
  .book-page.flipped {
    transform: rotateY(-180deg);
  }

  /* Contenu couverture */
  .cover-content {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    padding: 60px 40px;
    font-family: "Raleway", sans-serif;
  }

  .cover-ornament {
    font-size: 3rem;
    color: white;
    margin: 20px 0;
  }

  .cover-subtitle {
    font-size: 1.75rem;
    font-weight: 800;
    color: white;
    letter-spacing: 0.5em;
    margin-bottom: 30px;
  }

  .cover-main-title {
    font-size: 6rem;
    font-weight: 900;
    color: white;
    line-height: 0.9;
    margin-bottom: 30px;
  }

  .cover-main-title .name {
    font-size: 3.5rem;
    display: block;
    margin-top: 20px;
    font-weight: 800;
    letter-spacing: 0.4em;
  }

  .cover-tagline {
    font-size: 1.25rem;
    font-weight: 600;
    color: white;
    letter-spacing: 0.15em;
  }

  /* Contenu pages int√©rieures */
  .page-content {
    width: 100%;
    height: 100%;
    padding: 60px 50px;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 30px;
    font-family: "Raleway", sans-serif;
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: white;
    text-align: center;
    letter-spacing: 0.2em;
    margin-bottom: 20px;
    text-transform: uppercase;
  }

  .text-block {
    margin-bottom: 25px;
  }

  .text-block p {
    font-size: 1.3rem;
    line-height: 1.8;
    margin: 8px 0;
  }

  .skill-section {
    margin-bottom: 30px;
  }

  .skill-category {
    font-size: 1.5rem;
    font-weight: 800;
    color: white;
    margin-bottom: 15px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  .skill-section p {
    font-size: 1.2rem;
    line-height: 1.8;
    margin: 8px 0;
    padding-left: 15px;
  }

  .presentation-card-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    background: linear-gradient(145deg, #fefefe 0%, #f8f8f8 100%);
    backface-visibility: hidden;
    opacity: 1;
    transition: opacity 0.3s ease;
    font-family: "Raleway", sans-serif;
  }

  .presentation-card-container.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .technologies-page-content {
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .technologies-page-content.tech-hidden {
    opacity: 0;
    pointer-events: none;
  }

  .page-3 .page-front .technologies-page-content:not(.tech-hidden) {
    opacity: 1 !important;
    display: flex !important;
    visibility: visible !important;
  }

  .presentation-card {
    width: 100%;
    max-width: 480px;
    max-height: 670px;
    background: #f2f2f2;
    border-radius: 12px;
    padding: 28px;
    box-shadow:
      0 4px 8px rgba(0, 0, 0, 0.5),
      0 4px 8px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .card-frame {
    width: 100%;
    background: #d9d9d9;
    border-radius: 4px;
    padding: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card-image-container {
    width: 100%;
    aspect-ratio: 0.91;
    max-height: 380px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #d9d9d9;
  }

  .card-avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .card-name {
    font-size: 1.8rem;
    font-weight: 700;
    color: #000;
    margin: 0;
    padding: 0 8px;
  }

  .card-info-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 0 8px;
  }

  .card-info-item {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .card-icon {
    width: 24px;
    height: 24px;
    min-width: 24px;
    color: #878787;
    flex-shrink: 0;
  }

  .card-info-item span {
    font-size: 1.05rem;
    color: #000;
    line-height: 1.4;
  }

  .page-right-content {
    width: 100%;
    height: 100%;
    background: white;
    padding: 60px 50px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    backface-visibility: hidden;
    font-family: "Raleway", sans-serif;
  }

  .intro-section {
    display: flex;
    flex-direction: column;
    gap: 35px;
  }

  .intro-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #000;
    text-align: left;
    letter-spacing: 0.05em;
    margin: 0;
    font-family: "Raleway", sans-serif;
  }

  .profile-card {
    background: white;
    padding: 25px;
  }

  .profile-title {
    font-size: 1.4rem;
    font-weight: 800;
    color: #000;
    margin: 0 0 15px 0;
    letter-spacing: 0.05em;
    font-family: "Raleway", sans-serif;
  }

  .profile-card p {
    font-size: 1rem;
    line-height: 1.7;
    color: #333;
    margin: 0 0 12px 0;
    font-family: "Raleway", sans-serif;
  }

  .profile-card p:last-child {
    margin-bottom: 0;
  }

  .welcome-section {
    background: white;
    padding: 25px;
  }

  .welcome-title {
    font-size: 1.4rem;
    font-weight: 800;
    color: #000;
    margin: 0 0 15px 0;
    letter-spacing: 0.05em;
    font-family: "Raleway", sans-serif;
  }

  .welcome-section p {
    font-size: 1rem;
    line-height: 1.7;
    color: #333;
    margin: 0 0 20px 0;
    font-family: "Raleway", sans-serif;
  }

  .discover-button {
    background: transparent;
    border: none;
    color: #000;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 0;
    transition: all 0.3s ease;
    font-family: "Raleway", sans-serif;
  }

  .discover-button:hover {
    color: var(--color-light-blue);
  }

  .discover-button:hover .arrow-icon {
    transform: translateX(5px);
  }

  .arrow-icon {
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
  }
  /* ========== FIN CARTE LIVRE PORTFOLIO ========== */

  /* OLD STYLES - Cach√©s */
  .book-wrapper {
    display: none;
  }

  /* Livre 3D */
  .book-3d {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 1s cubic-bezier(0.645, 0.045, 0.355, 1);
    animation: book-entrance 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  .book-3d.opened {
    transform: translate3d(0, 0, 100px) rotateY(-20deg);
  }

  /* Couverture */
  .book-cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      135deg,
      #1565c0 0%,
      var(--color-light-blue) 50%,
      #1565c0 100%
    );
    border: 8px solid #0d47a1;
    border-radius: 12px;
    transform-style: preserve-3d;
    transform-origin: left center;
    transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1);
    z-index: 100;
    box-shadow:
      0 30px 80px rgba(0, 0, 0, 0.5),
      inset 0 2px 0 rgba(255, 255, 255, 0.2),
      inset 0 -4px 12px rgba(0, 0, 0, 0.3);
  }

  .book-cover.open {
    transform: rotateY(-165deg);
  }

  .cover-inner {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 60px 40px;
  }

  .cover-decoration-lines {
    position: absolute;
    inset: 30px;
    border: 4px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    pointer-events: none;
  }

  .cover-decoration-lines::before,
  .cover-decoration-lines::after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 3px;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.5),
      transparent
    );
  }

  .cover-decoration-lines::before {
    top: 0;
  }

  .cover-decoration-lines::after {
    bottom: 0;
  }

  .cover-ornament-top,
  .cover-ornament-bottom {
    font-size: 3rem;
    color: white;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    animation: ornament-glow 3s ease-in-out infinite;
  }

  .cover-ornament-top {
    margin-bottom: 20px;
  }

  .cover-ornament-bottom {
    margin-top: 20px;
  }

  .cover-subtitle {
    font-size: 1.5rem;
    font-weight: 800;
    color: rgba(255, 255, 255, 0.9);
    letter-spacing: 0.5em;
    margin-bottom: 10px;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .cover-title {
    font-size: 5rem;
    font-weight: 900;
    color: white;
    text-align: center;
    line-height: 0.9;
    text-shadow:
      0 4px 12px rgba(0, 0, 0, 0.5),
      0 0 30px rgba(255, 255, 255, 0.3);
    margin-bottom: 15px;
  }

  .cover-title .highlight {
    color: #ffeb3b;
    text-shadow:
      0 4px 12px rgba(0, 0, 0, 0.5),
      0 0 40px rgba(255, 235, 59, 0.8);
  }

  .cover-name {
    font-size: 2.5rem;
    display: block;
    margin-top: 10px;
    font-weight: 800;
    letter-spacing: 0.3em;
  }

  .cover-open-btn {
    margin-top: 40px;
    padding: 18px 50px;
    background: white;
    color: var(--color-dark-blue);
    border: 4px solid white;
    border-radius: 50px;
    font-size: 1.25rem;
    font-weight: 800;
    letter-spacing: 0.2em;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  .cover-open-btn:hover {
    background: #ffeb3b;
    color: var(--color-dark-blue);
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 12px 32px rgba(255, 235, 59, 0.5);
  }

  .cover-open-btn .arrow {
    transition: transform 0.3s ease;
  }

  .cover-open-btn:hover .arrow {
    transform: translateX(5px);
  }

  /* Tranche (√©paisseur) */
  .book-spine {
    position: absolute;
    left: -50px;
    top: 0;
    width: 50px;
    height: 100%;
    background: linear-gradient(90deg, #0a3a5a 0%, #1565c0 50%, #0a3a5a 100%);
    border-radius: 8px 0 0 8px;
    box-shadow:
      inset 4px 0 12px rgba(0, 0, 0, 0.5),
      -6px 0 20px rgba(0, 0, 0, 0.4);
  }

  .book-spine::after {
    content: "NICOLAS THAI - PORTFOLIO";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-90deg);
    color: white;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.2em;
    white-space: nowrap;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
  }

  /* Pages int√©rieures */
  .book-pages {
    position: absolute;
    inset: 8px;
    background: #fafafa;
    border-radius: 6px;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease 0.6s;
    transform-style: preserve-3d;
  }

  .book-pages.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* Pages compl√®tes - Structure CodePen */
  .full-page {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    transform-style: preserve-3d;
  }

  /* Effet d'√©paisseur sur le haut de la page (CodePen) */
  .full-page::before {
    content: "";
    position: absolute;
    top: -5px;
    left: 0;
    width: 100%;
    height: 5px;
    background: #bac1ba;
    transform-origin: bottom;
    transform: skewX(-45deg);
    z-index: 10;
  }

  /* Effet d'√©paisseur sur le c√¥t√© droit (CodePen) */
  .full-page::after {
    content: "";
    position: absolute;
    top: 0;
    right: -5px;
    width: 5px;
    height: 100%;
    background: #92a29c;
    transform-origin: left;
    transform: skewY(-45deg);
    z-index: 10;
  }

  .page-1 {
    z-index: 3;
  }
  .page-2 {
    z-index: 2;
  }
  .page-3 {
    z-index: 1;
  }

  /* Page Box - √âquivalent de .imgBox du CodePen */
  .page-box {
    width: 100%;
    height: 100%;
    position: relative;
    transform-origin: left;
    transition: transform 0.7s ease-out;
    transform-style: preserve-3d;
    box-shadow:
      inset 300px 0 50px rgba(0, 0, 0, 0.5),
      20px 0 60px rgba(0, 0, 0, 0.5);
  }

  .full-page.flipped .page-box {
    transform: rotateY(-135deg);
    box-shadow:
      inset 20px 0 50px rgba(0, 0, 0, 0.5),
      0 10px 100px rgba(0, 0, 0, 0.5);
  }

  /* Bark - Dos de la page (comme dans le CodePen) */
  .page-bark {
    position: absolute;
    background: #e0e1dc;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.6s;
  }

  .full-page.flipped .page-bark {
    opacity: 1;
    box-shadow: 300px 200px 100px rgba(0, 0, 0, 0.4) inset;
  }

  /* Content Wrapper - Contient le contenu visible */
  .page-content-wrapper {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  /* Layout des pages */
  .full-page-left,
  .full-page-right {
    width: 50%;
    height: 100%;
    float: left;
    background: linear-gradient(145deg, #fefefe 0%, #f8f8f8 100%);
    padding: 50px 40px 70px;
    overflow-y: auto;
    position: relative;
  }

  .full-page-left {
    border-right: 2px solid rgba(0, 0, 0, 0.1);
  }

  .full-page-left::before,
  .full-page-right::before {
    content: "";
    position: absolute;
    inset: 20px;
    border: 3px solid rgba(52, 190, 237, 0.15);
    border-radius: 12px;
    pointer-events: none;
  }

  .full-page-content {
    width: 100%;
    height: 100%;
    background: linear-gradient(145deg, #fefefe 0%, #f8f8f8 100%);
    padding: 50px 60px 70px;
    overflow-y: auto;
    position: relative;
  }

  .full-page-content::before {
    content: "";
    position: absolute;
    inset: 30px;
    border: 3px solid rgba(52, 190, 237, 0.15);
    border-radius: 12px;
    pointer-events: none;
  }

  .page-main-title {
    font-size: 2.25rem;
    font-weight: 900;
    color: var(--color-light-blue);
    text-align: center;
    margin-bottom: 35px;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  .icon-deco {
    font-size: 1.8rem;
    color: var(--color-dark-blue);
    animation: icon-pulse 2s ease-in-out infinite;
  }

  .mii-zone {
    display: flex;
    justify-content: center;
    margin: 30px 0;
  }

  .mii-placeholder-box {
    width: 180px;
    height: 180px;
    background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%);
    border: 4px dashed var(--color-light-blue);
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    animation: mii-float 3s ease-in-out infinite;
  }

  .mii-text {
    font-size: 0.875rem;
    font-weight: 800;
    color: var(--color-dark-gray);
    letter-spacing: 0.1em;
  }

  .mii-subtitle {
    font-size: 0.75rem;
    color: var(--color-text-gray);
    font-style: italic;
  }

  .info-card {
    background: linear-gradient(
      145deg,
      rgba(52, 190, 237, 0.12) 0%,
      rgba(52, 190, 237, 0.06) 100%
    );
    border: 4px solid var(--color-light-blue);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 6px 20px rgba(52, 190, 237, 0.15);
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
  }

  .emoji-icon {
    font-size: 1.75rem;
  }

  .card-header h3 {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--color-dark-blue);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .info-card p {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-text-gray);
    margin-bottom: 12px;
  }

  .welcome-card {
    background: white;
    border: 4px solid var(--color-dark-blue);
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .welcome-card h4 {
    font-size: 1.15rem;
    font-weight: 800;
    color: var(--color-light-blue);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .welcome-card p {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-text-gray);
  }

  .competence-section {
    height: 100%;
  }

  .competence-header {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 25px;
    border-radius: 16px;
    margin-bottom: 30px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  .competence-header.dev {
    background: linear-gradient(
      135deg,
      var(--color-light-blue) 0%,
      var(--color-dark-blue) 100%
    );
  }

  .competence-header.design {
    background: linear-gradient(135deg, #8e24aa 0%, #5e35b1 100%);
  }

  .icon-circle {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .icon-circle svg {
    width: 35px;
    height: 35px;
    color: var(--color-light-blue);
  }

  .competence-header.design .icon-circle svg {
    color: #8e24aa;
  }

  .competence-header h2 {
    font-size: 2rem;
    font-weight: 900;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  }

  .competence-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .comp-item {
    background: linear-gradient(
      145deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(248, 248, 248, 0.95) 100%
    );
    border: 4px solid var(--color-light-blue);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .comp-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(52, 190, 237, 0.25);
  }

  .comp-badge {
    display: inline-block;
    padding: 6px 16px;
    background: var(--color-light-blue);
    color: white;
    border-radius: 25px;
    font-size: 0.75rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 10px;
    box-shadow: 0 3px 8px rgba(52, 190, 237, 0.4);
  }

  .comp-badge.design-badge {
    background: #8e24aa;
    box-shadow: 0 3px 8px rgba(142, 36, 170, 0.4);
  }

  .comp-item h4 {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--color-dark-blue);
    margin-bottom: 10px;
  }

  .comp-item p {
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--color-text-gray);
  }

  /* C√¥t√©s (√©paisseur visible) */
  .book-side {
    position: absolute;
    background: linear-gradient(135deg, #0a3a5a 0%, #1565c0 50%, #0a3a5a 100%);
  }

  .book-side-right {
    right: -50px;
    top: 0;
    width: 50px;
    height: 100%;
    border-radius: 0 8px 8px 0;
    box-shadow: inset -4px 0 12px rgba(0, 0, 0, 0.5);
  }

  .book-side-left {
    left: 0;
    top: 0;
    width: 8px;
    height: 100%;
  }

  .book-side-top {
    top: -8px;
    left: 0;
    right: 0;
    height: 8px;
  }

  .book-side-bottom {
    bottom: -8px;
    left: 0;
    right: 0;
    height: 8px;
  }

  /* Navigation */
  .book-navigation {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 35px;
    background: linear-gradient(
      135deg,
      var(--color-dark-blue) 0%,
      var(--color-light-blue) 100%
    );
    padding: 18px 45px;
    border-radius: 70px;
    border: 5px solid white;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease 0.8s;
  }

  .book-navigation.visible {
    opacity: 1;
    pointer-events: auto;
  }

  .nav-button {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: white;
    border: 4px solid var(--color-light-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .nav-button svg {
    width: 30px;
    height: 30px;
    color: var(--color-light-blue);
  }

  .nav-button:hover {
    background: var(--color-light-blue);
    transform: scale(1.15);
    box-shadow: 0 6px 20px rgba(52, 190, 237, 0.5);
  }

  .nav-button:hover svg {
    color: white;
  }

  .nav-button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .page-indicator {
    font-size: 1.75rem;
    font-weight: 800;
    color: white;
    letter-spacing: 0.1em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  }

  /* Scrollbar */
  .full-page-left::-webkit-scrollbar,
  .full-page-right::-webkit-scrollbar,
  .full-page-content::-webkit-scrollbar,
  .page-content-wrapper::-webkit-scrollbar {
    width: 6px;
  }

  .full-page-left::-webkit-scrollbar-track,
  .full-page-right::-webkit-scrollbar-track,
  .full-page-content::-webkit-scrollbar-track,
  .page-content-wrapper::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  .full-page-left::-webkit-scrollbar-thumb,
  .full-page-right::-webkit-scrollbar-thumb,
  .full-page-content::-webkit-scrollbar-thumb,
  .page-content-wrapper::-webkit-scrollbar-thumb {
    background: var(--color-light-blue);
    border-radius: 10px;
  }

  /* Animations */
  @keyframes book-entrance {
    0% {
      opacity: 0;
      transform: scale(0.85) translateY(50px) rotateY(-20deg);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateY(0) rotateY(0deg);
    }
  }

  @keyframes ornament-glow {
    0%,
    100% {
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    }
    50% {
      text-shadow: 0 0 40px rgba(255, 255, 255, 0.9);
    }
  }

  @keyframes icon-pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.2);
    }
  }

  @keyframes mii-float {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }
</style>

<script is:inline>
  function initPresentationOverlay() {
    const overlay = document.querySelector(".presentation-overlay");
    const bookCard = document.getElementById("book-card");
    const pages = document.querySelectorAll(".book-page");
    const presentationContainer = document.querySelector(
      ".presentation-card-container"
    );
    const technologiesContainer = document.querySelector(
      ".technologies-page-content"
    );

    if (!overlay || !bookCard) {
      setTimeout(initPresentationOverlay, 100);
      return;
    }

    let currentPage = 0;
    const totalPages = pages.length;
    let isOpened = false;

    // Tourner la page suivante
    function nextPage() {
      if (currentPage < totalPages) {
        // Au premier clic, centrer le livre ET tourner la premi√®re page
        if (currentPage === 0) {
          bookCard.classList.add("opened");
          isOpened = true;
          pages[0].classList.add("flipped");
          currentPage++;
          if (presentationContainer) {
            presentationContainer.classList.remove("hidden");
          }
          console.log(
            `Page actuelle: ${currentPage}/${totalPages} (ouverture + premi√®re page)`
          );
        } else {
          // Cacher le contenu avant de tourner la page
          if (presentationContainer && currentPage === 1) {
            presentationContainer.classList.add("hidden");
          }
          // Pour les pages suivantes
          const pageToFlip = pages[currentPage];
          pageToFlip.classList.add("flipped");
          currentPage++;

          // G√©rer la visibilit√© des technologies apr√®s la fin de l'animation
          setTimeout(() => {
            console.log(
              `Gestion visibilit√© - currentPage: ${currentPage}, technologiesContainer:`,
              technologiesContainer
            );
            if (technologiesContainer) {
              if (currentPage === 3) {
                console.log(
                  "Retrait de tech-hidden pour afficher les technologies"
                );
                technologiesContainer.classList.remove("tech-hidden");
                console.log(
                  "Classes apr√®s retrait:",
                  technologiesContainer.className
                );
              } else {
                console.log(
                  "Ajout de tech-hidden pour cacher les technologies"
                );
                technologiesContainer.classList.add("tech-hidden");
              }
            } else {
              console.log("technologiesContainer est null!");
            }
          }, 750);

          console.log(`Page actuelle: ${currentPage}/${totalPages}`);
        }
      } else {
        // Retour au d√©but
        pages.forEach((page) => page.classList.remove("flipped"));
        bookCard.classList.remove("opened");
        currentPage = 0;
        isOpened = false;
        if (presentationContainer) {
          presentationContainer.classList.add("hidden");
        }
        if (technologiesContainer) {
          technologiesContainer.classList.add("tech-hidden");
        }
        console.log("Retour √† la couverture");
      }
    }

    // Observer pour r√©initialiser quand l'overlay se ferme
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (
          mutation.attributeName === "class" ||
          mutation.attributeName === "style"
        ) {
          const isVisible = !overlay.classList.contains("opacity-0");

          if (!isVisible && currentPage > 0) {
            // R√©initialiser toutes les pages
            pages.forEach((page) => page.classList.remove("flipped"));
            bookCard.classList.remove("opened");
            currentPage = 0;
            isOpened = false;
            if (presentationContainer) {
              presentationContainer.classList.add("hidden");
            }
            if (technologiesContainer) {
              technologiesContainer.classList.add("tech-hidden");
            }
          }
        }
      });
    });

    observer.observe(overlay, {
      attributes: true,
      attributeFilter: ["class", "style"],
    });

    // Clic sur la carte pour tourner les pages
    bookCard.addEventListener("click", (e) => {
      e.stopPropagation();
      nextPage();
    });

    // Bouton retour
    const returnButton = document.getElementById("presentation-return-button");
    if (returnButton) {
      returnButton.addEventListener("click", () => {
        overlay.classList.add("opacity-0", "pointer-events-none");
        overlay.classList.remove("opacity-100", "pointer-events-auto");
      });
    }

    console.log("Presentation overlay initialized!");
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initPresentationOverlay);
  } else {
    initPresentationOverlay();
  }
</script>
